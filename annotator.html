<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Tool - Neurodiagnoses</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="neurodiagnoses favicon-32x32.png">
</head>
<body>

    <header>
        <a href="index.html">Neurodiagnoses: AI-Powered Diagnostic Framework</a>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="annotator.html">Interactive Tool</a></li>
            <li><a href="research.html">Research</a></li>
            <li><a href="contribute.html">Get Involved</a></li>
            <li><a href="https://github.com/Fundacion-de-Neurociencias/neurodiagnoses" target="_blank">GitHub</a></li>
        </ul>
    </nav>

    <div class="container">
        <h1>Interactive Annotation Tool</h1>
        <p style="text-align: center;">Enter patient data below to generate a real-time, AI-driven 3-axis annotation using our live API.</p>
        
        <form id="annotation-form">
            <div class="form-grid">
                <h3 class="form-section-title">Axis 1: Etiology / Risk Factors</h3>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="etiology">Etiology Description</label>
                    <input id="etiology" type="text" value="Sporadic (APOE4 carrier, hypertension)" required>
                </div>

                <h3 class="form-section-title">Axis 2: Molecular Profile Features</h3>
                <div class="form-group"><label for="age2">Age</label><input id="age2" type="number" step="0.1" value="76.0" required></div>
                <div class="form-group"><label for="apoe4">APOE4 Alleles (0, 1, or 2)</label><input id="apoe4" type="number" value="1" required></div>
                <div class="form-group"><label for="adas13">ADAS-Cog 13 (baseline)</label><input id="adas13" type="number" step="0.1" value="18.5" required></div>
                <div class="form-group"><label for="hippocampus">Hippocampus Vol.</label><input id="hippocampus" type="number" step="0.1" value="3.1" required></div>
                <div class="form-group"><label for="ventricles">Ventricles Vol.</label><input id="ventricles" type="number" step="0.1" value="48.5" required></div>

                <h3 class="form-section-title">Axis 3: Phenotypic Profile Features</h3>
                <div class="form-group"><label for="age3">Age</label><input id="age3" type="number" value="76" required></div>
                <div class="form-group"><label for="mmse">MMSE Score</label><input id="mmse" type="number" value="24" required></div>
                <div class="form-group"><label for="hc_vol">Hippocampal Vol. (A3)</label><input id="hc_vol" type="number" step="0.1" value="3.1" required></div>
                <div class="form-group"><label for="cort_thick">Cortical Thickness</label><input id="cort_thick" type="number" step="0.1" value="1.8" required></div>
                <div class="form-group"><label for="vent_vol">Ventricular Vol. (A3)</label><input id="vent_vol" type="number" step="0.1" value="48.5" required></div>

                <button type="submit" class="tool-button">Generate Annotation</button>
            </div>
        </form>
        <div id="result">Annotation will appear here...</div>
    </div>

    <footer>
        &copy; 2025 Neurodiagnoses | An open-source project
    </footer>

    <script>
        document.getElementById('annotation-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const resultDiv = document.getElementById('result');
            const button = event.target.querySelector('button');
            resultDiv.textContent = 'Generating...';
            button.disabled = true;

            const payload = {
                etiology: document.getElementById('etiology').value,
                axis2_features: {
                    ADAS13_bl: parseFloat(document.getElementById('adas13').value),
                    APOE4: parseInt(document.getElementById('apoe4').value),
                    AGE: parseFloat(document.getElementById('age2').value),
                    Hippocampus: parseFloat(document.getElementById('hippocampus').value),
                    Ventricles: parseFloat(document.getElementById('ventricles').value)
                },
                axis3_features: {
                    hippocampal_volume: parseFloat(document.getElementById('hc_vol').value),
                    cortical_thickness: parseFloat(document.getElementById('cort_thick').value),
                    ventricular_volume: parseFloat(document.getElementById('vent_vol').value),
                    age: parseInt(document.getElementById('age3').value),
                    MMSE: parseInt(document.getElementById('mmse').value)
                }
            };

            try {
                const response = await fetch('http://127.0.0.1:8000/annotate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                resultDiv.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}. Is the API server running?`;
            } finally {
                button.disabled = false;
            }
        });
    </script>
</body>
</html>
